import{j as t,r as c,U as b,b as I,d as N,u as w,i as f}from"./index-C8qIewjV.js";import{M as _}from"./MainLayout-DDYl9PjF.js";const L=({name:i,image:u,numOfLearner:l,handleAddCourse:n})=>t.jsxs("div",{onClick:n,className:"w-full bg-[#eeeeee] p-5",children:[t.jsx("img",{src:u,className:"w-full h-[7rem] lazyload"}),t.jsxs("p",{className:"text-center font-medium mt-5 font-noto text-sm",children:["Tiếng ",i]}),t.jsxs("p",{className:"text-center font-medium font-noto text-sm",children:["Số người học: ",l]})]}),P=()=>{const{courseOfLearningProcess:i,setCourseOfLearningProcess:u}=c.useContext(b),{setIsLoading:l}=c.useContext(I),[n,h]=c.useState([]),[x,o]=c.useState(0);let[S,p]=N();const g=w();c.useEffect(()=>{(async()=>{l(!0),await f.get("courses",{onDownloadProgress:e=>{+Math.round(e.loaded*100/e.total)>=100&&l(!1)}}).then(e=>{var a,r;return h(((r=(a=e==null?void 0:e.data)==null?void 0:a.data)==null?void 0:r.courses)||[])}).catch(e=>e)})()},[]);const C=async(s,e)=>{if(x!==1)switch(o(1),s.status){case 1:case 2:await f.patch(`learning_process/update_recent_access?courseId=${e}`).then(a=>{g(`/learning?courseId=${e}`),u(r=>{const d=[...r],m=d.findIndex(j=>j.courseId._id.toString()===e);if(m>-1)return d.splice(m,1),d.unshift({...r[m]}),d}),o(0)}).catch(a=>{o(0)});return;default:try{await f.post(`learning_process/add_course?courseId=${e}`),p({courseId:e}),u(a=>{const r=[...a];return r.unshift({courseId:s,status:1,sections:[]}),r}),g(`/learning?courseId=${e}`),o(0)}catch(a){return o(0),a}}};return n.map(s=>s.status=0),i.forEach(s=>{const e=n.findIndex(a=>s.courseId._id.toString()===a._id.toString());e>-1&&(n[e].status=s.status)}),t.jsx(_,{children:t.jsxs("div",{className:"mt-[5rem] p-[0.8rem] md:absolute md:left-[5.5rem] lg:left-[17rem]",children:[t.jsxs("p",{className:"mb-4 font-noto text-xl font-medium md:mb-9",children:["Hãy lựa chọn các khóa học bạn cần:"," "]}),t.jsx("ul",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5",children:n&&n.map((s,e)=>t.jsxs("li",{className:"relative cursor-pointer rounded-lg bg-[#e5e5e5] shadow-xl hover:shadow-2xl",children:[t.jsx(L,{handleAddCourse:()=>C(s,s._id),name:s.name,image:s.image,numOfLearner:s.numOfLearner}),s.status!==0?t.jsx("p",{className:"absolute right-0 top-0 z-10 flex w-10 cursor-pointer items-center justify-center rounded-bl-lg bg-red-200 font-noto hover:bg-[#eeeeee] hover:text-black",children:t.jsx("i",{className:"fa-solid fa-check text-2xl font-bold"})}):null]},e))})]})})};export{P as default};
