import{r as a,U,j as e,i as N,b as me}from"./index-2-uEHcst.js";const xe=({question:t,lessonId:C,handleNextQuestion:R,setQuestionsCorrect:M})=>{const{setProfile:x,lessonsOfSummaryLesson:j,setLessonOfSummaryLesson:A}=a.useContext(U),[l,_]=a.useState(),[r,f]=a.useState(),[m,Q]=a.useState([]),[z,g]=a.useState(0),[v,k]=a.useState("");a.useEffect(()=>{const p=t==null?void 0:t.answers.map(w=>({answer:w,selected:!1}));Q(p)},[t]);const c=p=>{switch(p){case 0:return"A.";case 1:return"B.";case 2:return"C.";default:return"D."}},F=p=>{m.map(w=>w.selected=!1),m[p].selected=!0,Q([...m]),f(p+1)},b=()=>{const p=t==null?void 0:t.answers.map(w=>({answer:w,selected:!1}));Q(p),_(void 0),f(void 0),g(0)},D=async()=>{if(z!==1){if(g(1),!r){k("Bạn chưa chọn đáp án!"),setTimeout(()=>k(""),1500),g(0);return}try{if((await N.post(`questions/${t._id}`,{answer:r-1})).data.data.correct){g(0),M(w=>w+1),_(!0);return}else{M(0),_(!1),await N.patch("users/update_asset",{hearts:Math.random()}),x($=>({...$,hearts:$.hearts-1}));const w=j.findIndex($=>$.lesson._id.toString()===C);if(w>-1){if(j[w].wrongQuestions.findIndex(E=>E.toString()===t._id.toString())>-1){g(0);return}await N.patch("summary_lesson/update_lesson",{lessonId:C,questionId:t._id}),j[w].wrongQuestions.push(t._id.toString()),A([...j]),g(0);return}return}}catch{g(0)}}},h=()=>{l&&(R(),_(void 0),f(void 0),g(0))};return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto mb-2 mt-3 h-full w-full px-5 md:mt-7 md:w-[65%] md:px-0",children:[e.jsx("p",{className:"mb-2 text-center font-noto font-bold md:text-2xl",children:"Chọn đáp án đúng"}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{src:"/images/meo_image_learning.png",alt:"",className:"lazyload mr-2 h-10 w-10 md:mr-5 md:h-24 md:w-24"}),e.jsx("p",{className:"flex items-end font-noto md:text-xl",children:t==null?void 0:t.question})]}),e.jsx("div",{className:"mt-2 flex w-full items-center justify-center",children:e.jsx("ul",{className:"mt-4 grid w-[80%] grid-cols-1 gap-4 sm:grid-cols-2 md:mt-6 md:w-full",children:m&&m.map((p,w)=>e.jsxs("li",{onClick:()=>F(w),className:`border-1 cursor-pointer rounded-lg py-4 pl-2 pr-8 font-medium ${p.selected?"bg-[#d7ffb8]":"bg-[#eeeeee]"} px-2 hover:bg-[#d7ffb8] md:text-xl`,children:[e.jsx("span",{className:"pl-3 font-noto font-medium",children:c(w)}),e.jsx("span",{className:"font-noto",children:p.answer})]},w))})})]})]}),e.jsxs("div",{className:`fixed bottom-0 h-[10rem] w-full lg:h-[13rem] ${l===!0?"bg-[#d7ffb8]":l===!1?"bg-[#ffdfe0]":"bg-[#ffffff]"} border-t-2 border-t-[#e5e5e5] px-3 py-2 md:mt-6 md:px-0 md:py-3`,children:[e.jsxs("div",{className:"relative mx-auto flex w-full justify-between md:w-[65%]",children:[e.jsx("div",{className:"cursor-pointer",children:l===!0||l===!1?"":e.jsx("button",{onClick:b,className:"borer-[#e5e5e5] flex transform items-center justify-center rounded-xl border-[3px] border-b-[5px] bg-white px-6 py-2 font-noto font-medium text-[#afafaf] transition-all duration-300 hover:scale-105 active:scale-95 md:px-10 md:py-3 md:text-xl md:font-bold",children:"Làm lại"})}),e.jsx("div",{className:"cursor-pointer",children:l===!0?e.jsx("button",{onClick:h,className:"flex transform cursor-pointer items-center justify-center rounded-lg bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Câu tiếp theo"}):l===!1?e.jsx("button",{onClick:b,className:"borer-[#e5e5e5] flex transform cursor-pointer items-center justify-center rounded-xl border-[1px] border-b-[5px] bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Làm lại"}):e.jsx("button",{onClick:D,className:`flex transform cursor-pointer items-center justify-center rounded-lg ${r?"bg-[#58cc02] text-white":"bg-[#e5e5e5] text-[#afafaf]"} px-6 py-2 font-noto font-medium transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold`,children:"Kiểm tra đáp án"})}),l===!0?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-green-600 md:left-2 md:text-6xl",children:[e.jsx("p",{className:"max-w-fit",children:"Good!"}),e.jsx("p",{className:"text-xl",children:"Cùng tới với câu tiếp theo nào!"})]}):l===!1?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-red-600 md:left-2 md:text-6xl",children:[e.jsx("p",{className:"max-w-fit",children:"Sai!"}),e.jsx("p",{className:"text-xl",children:"Bạn làm sai rồi, làm lại nhé!"})]}):""]}),e.jsx("p",{className:"mt-3 w-full text-center font-noto text-lg font-semibold text-red-500 md:text-xl",children:v})]})]})})},ue=({question:t,lessonId:C,handleNextQuestion:R,setQuestionsCorrect:M})=>{var P;const{setProfile:x,lessonsOfSummaryLesson:j,setLessonOfSummaryLesson:A}=a.useContext(U),[l,_]=a.useState([]),[r,f]=a.useState([]),[m,Q]=a.useState(),[z,g]=a.useState(""),[v,k]=a.useState(0),[c,F]=a.useState([]),[b,D]=a.useState([]),[h,p]=a.useState(0);a.useEffect(()=>{const n=[];for(let d=0;d<=c.length/2+2;d+=2)n.push({left:c[d],right:c[d+1]});D(n)},[c]);function w(n){for(let d=n.length-1;d>0;d--){const y=Math.floor(Math.random()*(d+1));[n[d],n[y]]=[n[y],n[d]]}return n}a.useEffect(()=>{var y,T;const n=(y=t==null?void 0:t.rightOptions)==null?void 0:y.map(H=>({right:H,selected:!1})),d=(T=t==null?void 0:t.leftOptions)==null?void 0:T.map(H=>({left:H,selected:!1}));f(w(n)),_(d)},[t]);const $=(n,d)=>{l[d].selected!==!0&&h===0&&(p(1),l[d].selected=!0,_([...l]),F([...c,n]))},E=(n,d)=>{r[d].selected!==!0&&h===1&&(p(0),r[d].selected=!0,f([...r]),F([...c,n]))},K=async()=>{if(v!==1){if(k(1),b.length!==(t==null?void 0:t.leftOptions.length)){k(0),g("Hãy nối tất cả các từ đã cho bên dưới"),setTimeout(()=>g(""),1500);return}try{if((await N.post(`questions/${t._id}`,{answer:b})).data.data.correct){Q(!0),M(d=>d+1),k(0);return}else{Q(!1),M(0),await N.patch("users/update_asset",{hearts:Math.random()}),x(y=>({...y,hearts:y.hearts-1}));const d=j.findIndex(y=>y.lesson._id.toString()===C);if(d>-1){if(j[d].wrongQuestions.findIndex(T=>T.toString()===t._id.toString())>-1){k(0);return}await N.patch("summary_lesson/update_lesson",{lessonId:C,questionId:t._id}),j[d].wrongQuestions.push(t._id.toString()),A([...j]),k(0);return}return}}catch{k(0)}}},B=()=>{const n=t==null?void 0:t.rightOptions.map(y=>({right:y,selected:!1})),d=t==null?void 0:t.leftOptions.map(y=>({left:y,selected:!1}));p(0),f(w(n)),_(d),F([]),D([]),k(0),Q(void 0)},G=()=>{if(m){k(0),R(),F([]),D([]),Q(void 0);return}};return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto mt-[2rem] w-full px-5 md:w-[65%] md:px-0",children:[e.jsx("p",{className:"text-md text-center font-noto font-bold lg:text-lg",children:"Nối các từ từ bên cột trái với các từ tại cột phải sao cho đúng"}),e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("ul",{className:"mt-4 grid w-[44%] grid-cols-1 gap-2 md:mt-6 md:w-[33%]",children:l&&(l==null?void 0:l.map((n,d)=>e.jsxs("li",{onClick:()=>$(n==null?void 0:n.left,d),className:"border-1 text-md relative flex h-[2.5rem] w-full cursor-pointer items-center justify-center rounded-xl border-[2px] border-b-[4px] border-[#e5e5e5] p-1 font-noto hover:bg-green-200 active:scale-95 md:text-lg lg:h-[3rem]",children:[e.jsx("div",{className:"absolute left-[0.5rem] flex h-[2rem] w-[2rem] items-center justify-center rounded-full border-[2px] border-[#e5e5e5] text-[#afafaf] sm:left-[1rem]",children:d+1}),n!=null&&n.selected?"":n==null?void 0:n.left]},d)))}),e.jsx("ul",{className:"mt-4 grid w-[44%] grid-cols-1 gap-2 md:mt-6 md:w-[33%]",children:r&&(r==null?void 0:r.map((n,d)=>e.jsxs("li",{onClick:()=>E(n==null?void 0:n.right,d),className:"border-1 text-md relative flex h-[2.5rem] w-full cursor-pointer items-center justify-center rounded-xl border-[2px] border-b-[4px] border-[#e5e5e5] p-1 font-noto hover:bg-green-200 active:scale-95 md:text-lg lg:h-[3rem]",children:[e.jsx("div",{className:"absolute left-[0.5rem] flex h-[2rem] w-[2rem] items-center justify-center rounded-full border-[2px] border-[#e5e5e5] text-[#afafaf] sm:left-[1rem]",children:d+1}),n!=null&&n.selected?"":n==null?void 0:n.right]},d)))})]}),e.jsxs("h4",{className:"md:xl text-md md:text-md mb-2 mt-5 font-noto font-medium lg:mb-5 xl:text-lg",children:["Các từ đã nối:"," "]}),e.jsx("ul",{className:"flex flex-wrap justify-evenly gap-2",children:b&&b.map((n,d)=>e.jsxs("li",{className:"text-md flex rounded-xl border-[2px] border-b-[4px] border-[#e5e5e5] bg-white px-4 font-noto lg:px-6 lg:py-1",children:[e.jsx("p",{children:`${n.left?n.left+"__":""}`}),e.jsxs("p",{children:[" ",n.right?n.right:""]})]},d))})]}),e.jsxs("div",{className:`fixed bottom-0 h-[10rem] w-full ${m===!0?"bg-[#d7ffb8]":m===!1?"bg-[#ffdfe0]":"bg-[#ffffff]"} border-t-2 border-t-[#e5e5e5] px-3 py-2 md:mt-6 md:px-0 md:py-3`,children:[e.jsxs("div",{className:"relative mx-auto flex w-full justify-between md:w-[65%]",children:[e.jsx("div",{className:"cursor-pointer",children:m===!0||m===!1?"":e.jsx("button",{onClick:B,className:"borer-[#e5e5e5] flex transform items-center justify-center rounded-xl border-[3px] border-b-[5px] bg-white px-6 py-2 font-noto font-medium text-[#afafaf] transition-all duration-300 hover:scale-105 active:scale-95 md:px-10 md:py-3 md:text-xl md:font-bold",children:"Làm lại"})}),e.jsx("div",{className:"cursor-pointer",children:m===!0?e.jsx("button",{onClick:G,className:"flex transform cursor-pointer items-center justify-center rounded-lg bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Câu tiếp theo"}):m===!1?e.jsx("button",{onClick:B,className:"borer-[#e5e5e5] flex transform cursor-pointer items-center justify-center rounded-xl border-[1px] border-b-[5px] bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Làm lại"}):e.jsx("button",{onClick:K,className:`flex transform cursor-pointer items-center justify-center rounded-lg ${b.length===((P=t==null?void 0:t.leftOptions)==null?void 0:P.length)?"bg-[#58cc02] text-white":"bg-[#e5e5e5] text-[#afafaf]"} px-6 py-2 font-noto font-medium transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold`,children:"Kiểm tra đáp án"})}),m===!0?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-green-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Good!"}),e.jsx("p",{className:"text-xl",children:"Cùng tới với câu tiếp theo nào!"})]}):m===!1?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-red-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Sai!"}),e.jsx("p",{className:"text-xl",children:"Bạn làm sai rồi, làm lại nhé!"})]}):""]}),e.jsx("p",{className:"mt-3 w-full text-center font-noto text-lg font-semibold text-red-500 md:text-xl",children:z})]})]})})},fe=({question:t,lessonId:C,handleNextQuestion:R,setQuestionsCorrect:M})=>{const{setProfile:x,lessonsOfSummaryLesson:j,setLessonOfSummaryLesson:A}=a.useContext(U),[l,_]=a.useState((t==null?void 0:t.document)||""),[r,f]=a.useState((t==null?void 0:t.words)||[]),[m,Q]=a.useState(!1),[z,g]=a.useState([]),[v,k]=a.useState(void 0),[c,F]=a.useState(""),[b,D]=a.useState(0),h=a.useRef(),p=P=>{P.preventDefault()},w=(P,n)=>{n.target.innerHTML=r[m];const d=[...r];d.splice(m,1),f(d),Q(!1);const y=z.findIndex(T=>+T.index==+P);if(y>-1){const T=[...r];T.splice(m,1),T.splice(m,0,z[y].word),f(T),z[y].word=r[m],g([...z])}else g([...z,{index:P,word:r[m]}])},$=(P,n)=>{Q(n)},E=P=>{const n=P.split("__________");return n.map((d,y)=>y<n.length-1?e.jsxs(e.Fragment,{children:[d,e.jsx("div",{onDragOver:p,onDrop:T=>w(y,T),style:{userSelect:"none"},className:"m-1 inline-block h-6 w-24 rounded-sm bg-gray-300 text-center normal-case md:h-7 md:w-28"},y)]}):d)},K=async()=>{if(b!==1){if(D(1),z.length!==+(t==null?void 0:t.countCorrect)){D(0),F("Hãy điền đủ vị trí trống trong đoạn văn!"),setTimeout(()=>F(""),1500);return}try{if((await N.post(`questions/${t._id}`,{answer:z})).data.data.correct){M(n=>n+1),k(!0),D(0);return}else{M(0),k(!1),await N.patch("users/update_asset",{hearts:Math.random()}),x(d=>({...d,hearts:d.hearts-1}));const n=j.findIndex(d=>d.lesson._id.toString()===C);if(n>-1){if(j[n].wrongQuestions.findIndex(y=>y.toString()===t._id.toString())>-1){D(0);return}await N.patch("summary_lesson/update_lesson",{lessonId:C,questionId:t._id}),j[n].wrongQuestions.push(t._id.toString()),A([...j]),D(0);return}return}}catch{D(0)}}},B=()=>{if(D(0),f(t==null?void 0:t.words),g([]),k(void 0),Q(!1),h.current){const P=h.current.children;for(let n of P)n.innerHTML="&nbsp;"}};a.useEffect(()=>{if(_(t==null?void 0:t.document),f(t==null?void 0:t.words),g([]),k(void 0),Q(!1),h.current){const P=h.current.children;for(let n of P)n.innerHTML="&nbsp;"}},[t]);const G=()=>{if(v){R(),k(void 0),D(0);return}};return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto mt-3 w-full px-5 md:mb-8 md:mt-7 md:w-[75%] md:px-0",children:[e.jsx("p",{className:"text-md text-center font-noto font-medium md:mb-4 lg:text-lg",children:"Di chuyển các từ bên dưới để ghép vào chỗ trống của đoạn văn bên dưới sao cho đúng:"}),e.jsxs("div",{className:"mt-2 md:mt-6",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{src:"/images/meo_image_learning.png",alt:"",className:"lazyload mr-2 h-10 w-10 md:mr-5 md:h-24 md:w-24"}),e.jsx("div",{ref:h,className:"text-md inline-block w-full items-end font-noto lg:text-lg",children:E(l)})]}),e.jsx("div",{className:"mt-4 flex w-full items-center justify-center lg:mt-6",children:e.jsx("ul",{className:"flex w-full flex-wrap justify-evenly gap-1 md:gap-4 lg:mt-4 lg:w-5/6",children:r.map((P,n)=>e.jsx("li",{draggable:"true",onDragStart:()=>$(P,n),className:"border-1 cursor-pointer rounded-lg bg-[#eeeeee] px-6 py-1 text-sm lowercase hover:bg-green-400 md:px-8 lg:text-lg",children:P},n))})})]})]}),e.jsxs("div",{className:`fixed bottom-0 h-52 w-full ${v===!0?"bg-[#d7ffb8]":v===!1?"bg-[#ffdfe0]":"bg-[#ffffff]"} border-t-2 border-t-[#e5e5e5] px-3 py-2 md:mt-6 md:px-0 md:py-3`,children:[e.jsxs("div",{className:"relative mx-auto flex w-full justify-between md:w-[65%]",children:[e.jsx("div",{className:"cursor-pointer",children:v===!0||v===!1?"":e.jsx("button",{onClick:B,className:"flex transform items-center justify-center rounded-xl border-[3px] border-b-[5px] border-[#e5e5e5] bg-white px-6 py-2 font-noto font-medium text-[#afafaf] transition-all duration-300 hover:scale-105 active:scale-95 md:px-10 md:py-3 md:text-xl md:font-bold",children:"Làm lại"})}),e.jsx("div",{className:"cursor-pointer",children:v===!0?e.jsx("button",{onClick:G,className:"flex transform cursor-pointer items-center justify-center rounded-lg bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Câu tiếp theo"}):v===!1?e.jsx("button",{onClick:B,className:"borer-[#e5e5e5] flex transform cursor-pointer items-center justify-center rounded-xl border-[1px] border-b-[5px] bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Làm lại"}):e.jsx("button",{onClick:K,className:`flex transform cursor-pointer items-center justify-center rounded-lg ${z.length===+(t==null?void 0:t.countCorrect)?"bg-[#58cc02] text-white":"bg-[#e5e5e5] text-[#afafaf]"} px-6 py-2 font-noto font-medium transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold`,children:"Kiểm tra đáp án"})}),v===!0?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-green-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Good!"}),e.jsx("p",{className:"text-xl",children:"Cùng tới với câu tiếp theo nào!"})]}):v===!1?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-red-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Sai!"}),e.jsx("p",{className:"text-xl",children:"Bạn làm sai rồi, làm lại nhé!"})]}):""]}),e.jsx("p",{className:"mt-3 w-full text-center font-noto text-lg font-semibold text-red-500 md:text-xl",children:c})]})]})})},he=({question:t,lessonId:C,handleNextQuestion:R,setQuestionsCorrect:M})=>{const{setProfile:x,lessonsOfSummaryLesson:j,setLessonOfSummaryLesson:A}=a.useContext(U),[l,_]=a.useState(),[r,f]=a.useState([]),[m,Q]=a.useState([]),[z,g]=a.useState(0),[v,k]=a.useState("");a.useEffect(()=>{var p;const h=(p=t==null?void 0:t.words)==null?void 0:p.map(w=>({word:w,selected:!1}));Q(h)},[t]);const c=(h,p)=>{h.selected||(m[p].selected=!0,Q([...m]),f([...r,h.word]))},F=()=>{const h=t==null?void 0:t.words.map(p=>({word:p,selected:!1}));Q(h),_(void 0),f([]),g(0)},b=async()=>{if(z===1)return;if(g(1),r.length===0){k("Hãy chọn từ để sắp xếp"),setTimeout(()=>k(""),1500),g(0);return}const h=r.join(" ");try{if((await N.post(`questions/${t._id}`,{answer:h})).data.data.correct){g(0),M(w=>w+1),_(!0);return}else{M(0),_(!1),await N.patch("users/update_asset",{hearts:Math.random()}),x($=>({...$,hearts:$.hearts-1}));const w=j.findIndex($=>$.lesson._id.toString()===C);if(w>-1){if(j[w].wrongQuestions.findIndex(E=>E.toString()===t._id.toString())>-1){g(0);return}await N.patch("summary_lesson/update_lesson",{lessonId:C,questionId:t._id}),j[w].wrongQuestions.push(t._id.toString()),A([...j]),g(0);return}return}}catch{g(0)}},D=()=>{l&&(R(),_(void 0),f([]),g(0))};return e.jsx(e.Fragment,{children:t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mx-auto mb-2 mt-3 h-full w-full px-5 md:mt-7 md:w-[65%] md:px-0",children:[e.jsx("p",{className:"text-center font-noto font-bold md:text-xl",children:"Sắp xếp các từ bên dưới thành câu đúng nghĩa với câu đã cho:"}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{src:"/images/logo/speaker.png",alt:"",className:"lazyload mr-2 h-10 w-10 md:mr-2 md:h-16 md:w-16"}),e.jsxs("p",{className:"flex items-end font-noto md:text-xl",children:[': " ',t==null?void 0:t.document,' "']})]}),e.jsx("div",{className:"mt-3 flex h-[6rem] w-full items-center justify-center gap-1 rounded-xl border-2 border-[#e5e5e5] px-4",children:e.jsx("div",{className:"text-md flex h-auto flex-wrap gap-2 border-b-[1px] border-[#9f8c8c] px-4 lg:text-lg",children:r&&(r==null?void 0:r.map((h,p)=>e.jsx("p",{children:h},p)))})}),e.jsx("div",{className:"mt-4 flex w-full items-center justify-center",children:e.jsx("ul",{className:"flex w-full flex-wrap justify-evenly gap-1 md:gap-2 lg:w-5/6",children:m==null?void 0:m.map((h,p)=>e.jsx("li",{onClick:()=>c(h,p),className:"border-1 text-md h-[2.5rem] cursor-pointer rounded-lg border-[2px] border-[#e5e5e5] px-6 py-1 lowercase hover:bg-green-400 lg:px-8 lg:text-lg",children:h.selected===!1&&h.word?h.word:" "},p))})})]})]}),e.jsxs("div",{className:`fixed bottom-0 h-[10rem] w-full ${l===!0?"bg-[#d7ffb8]":l===!1?"bg-[#ffdfe0]":"bg-[#ffffff]"} border-t-2 border-t-[#e5e5e5] px-3 py-2 md:mt-6 md:px-0 md:py-3`,children:[e.jsxs("div",{className:"relative mx-auto flex w-full justify-between md:w-[65%]",children:[e.jsx("div",{className:"cursor-pointer",children:l===!0||l===!1?"":e.jsx("button",{onClick:F,className:"borer-[#e5e5e5] flex transform items-center justify-center rounded-xl border-[3px] border-b-[5px] bg-white px-6 py-2 font-noto font-medium text-[#afafaf] transition-all duration-300 hover:scale-105 active:scale-95 md:px-10 md:py-3 md:text-xl md:font-bold",children:"Làm lại"})}),e.jsx("div",{className:"cursor-pointer",children:l===!0?e.jsx("button",{onClick:D,className:"flex transform cursor-pointer items-center justify-center rounded-lg bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Câu tiếp theo"}):l===!1?e.jsx("button",{onClick:F,className:"borer-[#e5e5e5] flex transform cursor-pointer items-center justify-center rounded-xl border-[1px] border-b-[5px] bg-[#58cc02] px-6 py-2 font-noto font-medium text-white transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold",children:"Làm lại"}):e.jsx("button",{onClick:b,className:`flex transform cursor-pointer items-center justify-center rounded-lg ${r.length>0?"bg-[#58cc02] text-white":"bg-[#e5e5e5] text-[#afafaf]"} px-6 py-2 font-noto font-medium transition-all duration-300 hover:scale-105 active:scale-95 md:px-6 md:py-3 md:text-lg md:font-bold`,children:"Kiểm tra đáp án"})}),l===!0?e.jsxs("div",{className:"absolute left-2 top-[2.1rem] text-4xl font-bold text-green-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Good!"}),e.jsx("p",{className:"text-sm md:text-xl",children:"Cùng tới với câu tiếp theo nào!"})]}):l===!1?e.jsxs("div",{className:"top-[2.1rem]text-4xl absolute left-2 font-bold text-red-600 md:left-2 md:text-6xl",children:[e.jsx("p",{children:"Sai!"}),e.jsx("p",{className:"text-sm md:text-xl",children:"Bạn làm sai rồi, làm lại nhé!"})]}):""]}),e.jsx("p",{className:"mt-3 w-full text-center font-noto text-lg font-semibold text-red-500 md:text-xl",children:v})]})]})})},pe=({setIsCongratulation:t,currentLesson:C,lessons:R,setIsLesson:M})=>{const x=()=>{t(!1),M(!1)};return e.jsx("div",{className:"fixed z-30 mx-auto my-auto flex h-screen w-full items-center justify-center bg-[#e8e8e8]",children:e.jsxs("div",{className:"w-[95%] sm:w-[70%]",children:[e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsxs("div",{style:{clipPath:"polygon(0% 0%, 100% 0%, 100% 96%, 64% 96%, 51% 100%, 36% 96%, 0 95%)"},className:"ml-2 w-[70%] rounded-xl bg-white p-4 font-noto",children:[e.jsxs("ul",{className:"flex justify-center items-center text-center text-2xl font-bold",children:[e.jsx("li",{children:e.jsx("img",{src:"/images/congru.png",className:"w-12 h-12 lazyload"})}),e.jsx("li",{className:"ml-2",children:"CHÚC MỪNG"})]}),e.jsx("p",{className:"text-center",children:"Bạn vừa hoàn thành một bài học"}),e.jsx("p",{className:"text-center font-noto",children:"Bạn đã nhận được: "}),e.jsxs("ul",{className:"mx-auto mt-3 mb-3 flex w-[90%] sm:w-[60%] justify-around text-left text-xl font-bold",children:[e.jsxs("li",{className:"flex items-center",children:[R[C-1].gems,e.jsx("img",{src:"/images/logo/coins.png",className:"ml-1 h-4 lazyload"})]}),e.jsxs("li",{className:"flex items-center",children:[R[C-1].experiences,e.jsx("img",{src:"/images/logo/explogo.jfif",className:"ml-1 h-4 lazyload"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{children:"5"}),e.jsx("img",{src:"/images/logo/heart.webp",className:"ml-1 h-4 lazyload"})]})]}),e.jsx("div",{onClick:()=>x(),className:"w-[9rem] text-center mx-auto mb-4 mt-5 cursor-pointer border-2 border-[#b7dceb] rounded-lg bg-[#d3e9f8] hover:text-white hover:border-[#dfe1e2] shadow-xl",children:"Tiếp tục"})]})}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("img",{src:"/images/cat_congru1.png",className:"h-[10rem] w-[10rem] lazyload"})})]})})},ge=({listMisson:t,setListMisson:C,isShowInfoMisson:R,setIsShowInfoMisson:M})=>{const{setProfile:x}=a.useContext(U),[j,A]=a.useState([]);return a.useEffect(()=>{const l=t.length!==0&&t.reduce((_,r)=>(_.some(f=>f.missonId.type===r.missonId.type)||_.push(r),_),[]);A(l)},[t]),a.useEffect(()=>{(async()=>{const _=t.filter(r=>r.completed===!0&&r.missonId.type!=="questions");if(_.length!==0){const r=_.reduce((f,m)=>(m.completed&&(f.gems+=m.missonId.gems,f.experiences+=m.missonId.experiences,f.turns+=m.missonId.hearts),f),{gems:0,experiences:0,turns:0});await N.patch("users/update_asset",r).then(()=>{x(f=>{const m={...f};return m.experiences=+m.experiences+ +r.experiences,m.gems=+m.gems+ +r.gems,m.hearts=+m.hearts+ +r.turns,m})}).catch(f=>f)}})()},[t]),R&&t&&j.length!==0&&e.jsx("div",{className:"fixed z-30 mx-auto my-auto flex h-screen w-full items-center justify-center bg-[#e8e8e8]",children:e.jsx("div",{className:"w-[95%]",children:e.jsx("div",{className:"flex w-full items-center justify-center",children:e.jsxs("div",{className:"ml-2 w-[90%] rounded-xl bg-white p-4 font-noto md:w-[70%]",children:[e.jsx("p",{className:"md:text-md text-center text-xs font-semibold uppercase lg:text-lg",children:"Tiến trình hiện tại của các nhiệm vụ"}),e.jsx("ul",{className:"mt-4 max-h-[70vh] space-y-3 overflow-scroll scrollbar-none",children:j&&j.map((l,_)=>e.jsxs("li",{className:`w-full ${l.completed?"bg-[#ebf9e4] text-black":""} rounded-xl border-[1px] border-[#e5e5e5] p-4`,children:[e.jsxs("div",{className:"flex",children:[e.jsxs("ul",{className:"flex-grow items-start",children:[e.jsx("li",{className:"pl-2 tracking-wider",children:l.missonId.misson}),e.jsxs("li",{className:"relative ml-1 mt-2 h-6 w-full rounded-xl bg-[#e5e5e5]",children:[e.jsx("div",{style:{width:`${+l.currentProgress<=+l.missonId.numberOfRequirements?+l.currentProgress/+l.missonId.numberOfRequirements*100:100}%`},className:"absolute top-[1.3px] h-[1.3rem] rounded-xl bg-[#58cc02] transition-all duration-500 ease-linear"}),e.jsxs("p",{className:"absolute left-[40%] top-0 font-noto font-semibold text-white",children:[l.currentProgress," /"," ",l.missonId.numberOfRequirements]})]})]}),e.jsxs("div",{className:"relative ml-4 flex items-end justify-center",children:[e.jsx("img",{src:"/images/logo/misson-gift.svg",className:"lazyload h-9 w-9"}),l.completed&&e.jsx("i",{className:"fa-solid fa-check absolute right-[-0.7rem] top-[0.5rem] hidden text-[3.5rem] font-bold text-[#774e2f] md:flex"})]})]}),l.completed&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mt-3 text-center font-noto text-black",children:["Bạn đã nhận được:"," "]}),e.jsxs("ul",{className:"mx-auto flex w-[90%] justify-around text-left text-xl font-bold sm:w-[60%]",children:[e.jsxs("li",{className:"flex items-center",children:[l.missonId.gems,e.jsx("img",{src:"/images/logo/coins.png",className:"lazyload ml-1 h-4"})]}),e.jsxs("li",{className:"flex items-center",children:[l.missonId.experiences,e.jsx("img",{src:"/images/logo/explogo.jfif",className:"lazyload ml-1 h-4"})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx("span",{children:l.missonId.hearts}),e.jsx("img",{src:"/images/logo/heart.webp",className:"lazyload ml-1 h-4"})]})]})]})]},_))}),e.jsx("div",{onClick:()=>{M(!1),C([])},className:"mx-auto mb-4 mt-5 w-[9rem] cursor-pointer rounded-lg border-2 border-[#b7dceb] bg-[#d3e9f8] text-center shadow-xl hover:border-[#dfe1e2] hover:text-white",children:"Đóng"})]})})})})},oe=()=>{const t=new Date(Date.now()),C=t.getFullYear(),R=t.getMonth(),M=t.getDate();return`${C}-${R+1}-${M}`},je=({courseId:t,sectionId:C,milestoneId:R,setIsLesson:M,lessons:x,currentLesson:j,setCurrentLesson:A})=>{var J,V,X,Z,q,ee,te,se,re,ne,ae,le,de;const{profile:l,setProfile:_,missons:r,setMissons:f,setCourseOfLearningProcess:m,lessonsOfSummaryLesson:Q,setLessonOfSummaryLesson:z}=a.useContext(U),{setIsLoading:g}=a.useContext(me),[v,k]=a.useState(0),[c,F]=a.useState(j||1),[b,D]=a.useState(x[c-1]&&((J=x[c-1])==null?void 0:J.questions)),[h,p]=a.useState(x[c-1]&&x[c-1]._id),w=a.useRef(null),[$,E]=a.useState(0),[K,B]=a.useState(!1),[G,P]=a.useState([]),[n,d]=a.useState(!1),[y,T]=a.useState(0);a.useEffect(()=>{x.length===0&&M(!1)},[x]),a.useEffect(()=>{(async()=>{var s,o,I;try{g(!0);const O=await N.get(`lessons/${x[c-1]._id}`,{onDownloadProgress:L=>{+Math.round(L.loaded*100/L.total)>=100&&g(!1)}});D((I=(o=(s=O==null?void 0:O.data)==null?void 0:s.data)==null?void 0:o.lesson)==null?void 0:I.questions)}catch(O){return O}})(),p(x[c-1]&&x[c-1]._id)},[c,j]);const H=r.map((S,s)=>{if(S.completed===!1)return{index:s,misson:S}}).filter(S=>S!==void 0);let W=[...G];a.useEffect(()=>{H==null||H.map(async S=>{var s,o,I,O;if(((o=(s=S==null?void 0:S.misson)==null?void 0:s.missonId)==null?void 0:o.type)==="questions"&&+y==+((O=(I=S==null?void 0:S.misson)==null?void 0:I.missonId)==null?void 0:O.numberOfRequirements))try{await N.patch(`user_missons/update?missonId=${S.misson.missonId._id}`,{currentProgress:y,status:!0}),await N.patch("users/update_asset",{experiences:S.misson.missonId.experiences,gems:S.misson.missonId.gems,turns:S.misson.missonId.hearts}),f(L=>{const i=[...L];return i[S.index].currentProgress=y,i[S.index].completed=!0,i}),_(L=>{const i={...L};return i.experiences=+i.experiences+ +S.misson.missonId.experiences,i.gems=+i.gems+ +S.misson.missonId.gems,i.hearts=+i.hearts+ +S.misson.missonId.hearts,i}),P(L=>{let i=[...L];return(i==null?void 0:i.findIndex(ie=>ie.missonId._id.toString()===S.misson.milestoneId._id.toString()))>-1?i:i=[...L,S.misson]}),d(!0)}catch{}})},[y]);const Y=a.useCallback(async()=>{if($!==1){if(E(1),k(v+1),v+1>(b==null?void 0:b.length)-1)try{if(c+1>x.length){g(!0),await N.patch("learning_process/update_milestone",{courseId:t,sectionId:C,milestoneId:R,currentLesson:j,totalLessonDone:j,status:2}),await N.patch("learning_process/update_section",{courseId:t,sectionId:C,totalMilestoneDone:c}),await N.patch("users/update_asset",{experiences:+x[c-1].experiences,gems:+x[c-1].gems,turns:5,dayStreak:Math.random()}),_(s=>{const o={...s};return o.experiences=+o.experiences+ +x[c-1].experiences,o.gems=+o.gems+ +x[c-1].gems,o.hearts=+o.hearts+5,o});const S=H.map(async s=>{var o,I;switch((I=(o=s==null?void 0:s.misson)==null?void 0:o.missonId)==null?void 0:I.type){case"gems":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:+x[c-1].gems,status:+r[s.index].currentProgress+ +x[c-1].gems>=+r[s.index].missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+ +x[c-1].gems,u[s.index].completed=+r[s.index].currentProgress>=+r[s.index].missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"experiences":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:+x[c-1].experiences,status:+r[s.index].currentProgress+ +x[c-1].experiences>=+r[s.index].missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+ +x[c-1].experiences,u[s.index].completed=+r[s.index].currentProgress>=+r[s.index].missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"lessons":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:1,status:+r[s.index].currentProgress+1>=+r[s.index].missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+1,u[s.index].completed=+r[s.index].currentProgress>=+r[s.index].missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"days":const O=oe(),L=l.activeDays.inCludes(O);await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:L?"0":1,status:+r[s.index].currentProgress+L?"0":1>=+r[s.index].missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+L?0:1,u[s.index].completed=+r[s.index].currentProgress>=+r[s.index].missonId.numberOfRequirements,u}),W=[...W,s.misson];break;default:}});await Promise.all(S),g(!1),P(s=>[...s,...W]),B(!0),d(!0),m(s=>{const o=[...s],I=o.findIndex(i=>i.courseId._id.toString()===t.toString()),O=o[I].sections.findIndex(i=>i.sectionId.toString()===C.toString());o[I].sections[O].totalMilestoneDone=+o[I].sections[O].totalMilestoneDone+1;const L=o[I].sections[O].milestones.findIndex(i=>i.milestoneId.toString()===R.toString());return o[I].sections[O].milestones[L].currentLesson=c+1,o[I].sections[O].milestones[L].status=2,o}),E(0);return}else{g(!0),await N.patch("users/update_asset",{experiences:+x[c-1].experiences,gems:+x[c-1].gems,turns:5,dayStreak:Math.random()}),_(s=>{const o={...s};return o.experiences=+o.experiences+ +x[c-1].experiences,o.gems=+o.gems+ +x[c-1].gems,o.hearts=+o.hearts+5,o}),await N.patch("learning_process/update_milestone",{courseId:t,sectionId:C,milestoneId:R,currentLesson:j,totalLessonDone:j});const S=H.map(async s=>{var o,I;switch((I=(o=s==null?void 0:s.misson)==null?void 0:o.missonId)==null?void 0:I.type){case"gems":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:+x[c-1].gems,status:+r[s.index].currentProgress+ +x[c-1].gems>=+s.misson.missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+ +x[c-1].gems,u[s.index].completed=+r[s.index].currentProgress>=+s.misson.missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"experiences":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:+x[c-1].experiences,status:+r[s.index].currentProgress+ +x[c-1].experiences>=+s.misson.missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+ +x[c-1].experiences,u[s.index].completed=+r[s.index].currentProgress>=+s.misson.missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"lessons":await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:1,status:+r[s.index].currentProgress+1>=+s.misson.missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+1,u[s.index].completed=+r[s.index].currentProgress>=+s.misson.missonId.numberOfRequirements,u}),W=[...W,s.misson];break;case"days":const O=oe(),L=l.activeDays.inCludes(O);await N.patch(`user_missons/update?missonId=${s.misson.missonId._id}`,{currentProgress:L?"0":1,status:+r[s.index].currentProgress+L?"0":1>=+r[s.index].missonId.numberOfRequirements}),f(i=>{const u=[...i];return u[s.index].currentProgress=+u[s.index].currentProgress+L?0:1,u[s.index].completed=+r[s.index].currentProgress>=+r[s.index].missonId.numberOfRequirements,u}),W=[...W,s.misson];break;default:}});await Promise.all(S),g(!1),P(s=>[...s,...W]),B(!0),d(!0),A(c+1),m(s=>{const o=[...s],I=o.findIndex(i=>i.courseId._id.toString()===t.toString()),O=o[I].sections.findIndex(i=>i.sectionId.toString()===C.toString()),L=o[I].sections[O].milestones.findIndex(i=>i.milestoneId.toString()===R.toString());return o[I].sections[O].milestones[L].currentLesson=c+1,o}),E(0)}}catch{E(0)}E(0)}},[v]),ce=()=>{M(!1)};return a.useEffect(()=>{w.current.style.width=v/(b==null?void 0:b.length)*100+"%"},[b,v]),a.useEffect(()=>{(async()=>{if(!(Q.findIndex(o=>o.lesson._id.toString()===h.toString())>-1))try{await N.patch("summary_lesson/add_lesson",{lessonId:h}),z(o=>{const I=[...o];return I.push({lesson:{_id:h},wrongQuestions:[]}),I})}catch{}})()},[h]),e.jsxs(e.Fragment,{children:[K&&e.jsx(pe,{lessons:x,currentLesson:j,setIsCongratulation:B,setIsLesson:M}),e.jsx(ge,{listMisson:G,setListMisson:P,isShowInfoMisson:n,setIsShowInfoMisson:d}),e.jsxs("div",{className:"relative h-screen w-full py-6",children:[e.jsxs("ul",{className:"mx-auto flex w-[90%] items-center justify-center md:w-[75%]",children:[e.jsx("li",{children:e.jsx("i",{onClick:ce,className:"fa-solid fa-arrow-left cursor-pointer text-2xl md:text-3xl"})}),e.jsx("li",{className:"mx-3 h-4 w-full rounded-md bg-[#e5e5e5]",children:e.jsx("div",{ref:w,className:"ml-[2px] mt-[2px] h-[0.8rem] w-[0%] rounded-md bg-red-600 transition ease-linear"})}),e.jsxs("li",{className:"flex items-center justify-center",children:[e.jsx("img",{src:"/images/logo/heart.webp",className:"h-7 w-7"}),e.jsx("p",{className:"lazyload ml-1 flex items-center justify-center font-noto text-2xl font-medium text-red-600 md:text-3xl",children:l!=null&&l.hearts?l==null?void 0:l.hearts:0})]})]}),b&&((X=(V=b[v])==null?void 0:V.question)==null?void 0:X.type)==="choose"?e.jsx(xe,{question:(Z=b[v])==null?void 0:Z.question,lessonId:h,handleNextQuestion:Y,setQuestionsCorrect:T}):b&&((ee=(q=b[v])==null?void 0:q.question)==null?void 0:ee.type)==="match"?e.jsx(ue,{question:(te=b[v])==null?void 0:te.question,lessonId:h,handleNextQuestion:Y,setQuestionsCorrect:T}):b&&((re=(se=b[v])==null?void 0:se.question)==null?void 0:re.type)==="fill"?e.jsx(fe,{question:(ne=b[v])==null?void 0:ne.question,lessonId:h,handleNextQuestion:Y,setQuestionsCorrect:T}):b&&((le=(ae=b[v])==null?void 0:ae.question)==null?void 0:le.type)==="rearrange"?e.jsx(he,{question:(de=b[v])==null?void 0:de.question,lessonId:h,handleNextQuestion:Y,setQuestionsCorrect:T}):""]})]})};export{je as default};
